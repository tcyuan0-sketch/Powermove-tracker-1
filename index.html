<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Breakdancing Power Move Scorer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }
        
        /* Header Styles */
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-bottom: 3px solid #e74c3c;
        }
        
        .header h1 {
            font-size: 2.2em;
            margin-bottom: 8px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.4);
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        
        .header p {
            font-size: 1em;
            opacity: 0.9;
            font-weight: 500;
        }
        
        /* Table Styles */
        .table-container {
            padding: 30px;
            overflow-x: auto;
        }
        
        .section-title {
            margin: 30px 0 20px 0;
            color: #2c3e50;
            font-size: 1.3em;
            text-align: center;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        th {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 15px 12px;
            font-weight: 700;
            text-align: left;
            font-size: 0.9em;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #ecf0f1;
            vertical-align: middle;
        }
        
        /* Row Styles by Category */
        .basic { border-left: 3px solid #3498db; }
        .intermediate { border-left: 3px solid #f39c12; }
        .advanced { border-left: 3px solid #e74c3c; }
        
        .basic:hover { background: rgba(52, 152, 219, 0.1); }
        .intermediate:hover { background: rgba(243, 156, 18, 0.1); }
        .advanced:hover { background: rgba(231, 76, 60, 0.1); }
        
        .move-name {
            font-weight: 700;
            color: #2c3e50;
            letter-spacing: 0.3px;
            cursor: pointer;
        }
        
        .move-name:hover {
            color: #3498db;
            text-decoration: underline;
        }
        
        .base-points {
            font-weight: 700;
            color: #27ae60;
        }
        
        .total-points {
            font-weight: 700;
            color: #e74c3c;
            font-size: 1.05em;
        }
        
        /* Slider Controls */
        .slider-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 120px;
        }
        
        .slider {
            width: 100px;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(90deg, #ecf0f1, #bdc3c7);
            outline: none;
            cursor: pointer;
            transition: all 0.2s ease;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db, #2980b9);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(52, 152, 219, 0.3);
            transition: all 0.2s ease;
        }
        
        .slider::-webkit-slider-thumb:hover {
            background: linear-gradient(135deg, #2980b9, #3498db);
            transform: scale(1.1);
            box-shadow: 0 3px 10px rgba(52, 152, 219, 0.5);
        }
        
        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db, #2980b9);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(52, 152, 219, 0.3);
            border: none;
            transition: all 0.2s ease;
        }
        
        .slider::-moz-range-thumb:hover {
            background: linear-gradient(135deg, #2980b9, #3498db);
            transform: scale(1.1);
            box-shadow: 0 3px 10px rgba(52, 152, 219, 0.5);
        }
        
        .slider:focus {
            background: linear-gradient(90deg, #3498db, #2980b9);
            box-shadow: 0 0 8px rgba(52, 152, 219, 0.25);
        }
        
        .slider-label {
            font-size: 11px;
            font-weight: 600;
            color: #34495e;
            margin-top: 4px;
            text-align: center;
            min-height: 16px;
            line-height: 1.2;
        }
        
        .form-slider {
            background: linear-gradient(90deg, #f39c12, #e67e22);
        }
        
        .form-slider::-webkit-slider-thumb {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            box-shadow: 0 2px 6px rgba(243, 156, 18, 0.3);
        }
        
        .form-slider::-webkit-slider-thumb:hover {
            background: linear-gradient(135deg, #e67e22, #f39c12);
            box-shadow: 0 3px 10px rgba(243, 156, 18, 0.5);
        }
        
        .form-slider::-moz-range-thumb {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            box-shadow: 0 2px 6px rgba(243, 156, 18, 0.3);
        }
        
        .form-slider:focus {
            background: linear-gradient(90deg, #f39c12, #e67e22);
            box-shadow: 0 0 8px rgba(243, 156, 18, 0.25);
        }
        
        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 28px;
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #bdc3c7;
            display: inline-block;
        }
        
        .toggle-switch.active {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            border-color: #27ae60;
        }
        
        .toggle-switch::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 26px;
            height: 20px;
            background: white;
            border-radius: 2px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .toggle-switch.active::before {
            transform: translateX(28px);
        }
        
        .toggle-switch::after {
            content: 'NO';
            position: absolute;
            top: 50%;
            left: 32px;
            transform: translateY(-50%);
            font-size: 10px;
            font-weight: 700;
            color: white;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }
        
        .toggle-switch.active::after {
            content: 'YES';
            left: 6px;
        }
        
        /* Total Row Styles */
        .total-row {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%) !important;
            color: white !important;
            font-weight: bold;
        }
        
        .total-row td {
            padding: 15px 12px;
            font-size: 1.1em;
            border-bottom: none;
        }
        
        .grand-total-row {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%) !important;
        }
        
        /* Button Styles */
        .button-container {
            display: flex;
            gap: 15px;
            margin: 20px 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .btn {
            padding: 12px 30px;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            min-width: 150px;
        }
        
        .btn:hover {
            transform: translateY(-1px);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
            font-size: 1.6em;
            padding: 25px;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            box-shadow: 0 2px 8px rgba(127, 140, 141, 0.3);
        }
        
        /* Score Display */
        .score-display {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 1.4em;
            font-weight: 700;
            letter-spacing: 0.5px;
            margin-bottom: 20px;
            display: none;
        }
        
        /* Summary Section */
        .summary-section {
            display: none;
            padding: 30px;
            background: #f8f9fa;
            border-top: 3px solid #e74c3c;
        }
        
        .summary-title {
            color: #2c3e50;
            font-size: 1.5em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }
        
        .summary-description {
            color: #7f8c8d;
            font-size: 1em;
            margin-bottom: 30px;
            font-weight: 500;
        }
        
        /* Analysis Charts */
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        
        .chart-box {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #ecf0f1;
        }
        
        .chart-title {
            font-size: 1.1em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 8px 12px;
            border-radius: 4px;
        }
        
        .stat-row.basic { background: linear-gradient(90deg, rgba(52, 152, 219, 0.1), rgba(41, 128, 185, 0.1)); }
        .stat-row.intermediate { background: linear-gradient(90deg, rgba(243, 156, 18, 0.1), rgba(230, 126, 34, 0.1)); }
        .stat-row.advanced { background: linear-gradient(90deg, rgba(231, 76, 60, 0.1), rgba(192, 57, 43, 0.1)); }
        
        .progress-bar {
            background: #ecf0f1;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.8s ease;
        }
        
        .progress-bar.basic .progress-fill { background: linear-gradient(90deg, #3498db, #2980b9); }
        .progress-bar.intermediate .progress-fill { background: linear-gradient(90deg, #f39c12, #e67e22); }
        .progress-bar.advanced .progress-fill { background: linear-gradient(90deg, #e74c3c, #c0392b); }
        
        .stat-label { font-weight: 600; color: #34495e; }
        .stat-value { font-weight: 700; color: #e74c3c; }
        
        /* Notification System */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 6px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            opacity: 0;
            transform: translateX(100px);
            transition: all 0.4s ease;
        }
        
        .notification.success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        /* Info Tooltip */
        .info-icon {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 18px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            margin-left: 5px;
            position: relative;
            vertical-align: middle;
        }
        
        .info-tooltip {
            position: absolute;
            background: #2c3e50;
            color: white;
            padding: 10px;
            border-radius: 6px;
            font-size: 13px;
            line-height: 1.4;
            width: 200px;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .info-tooltip::before {
            content: '';
            position: absolute;
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-bottom: 6px solid #2c3e50;
        }
        
        .info-icon:hover .info-tooltip,
        .info-icon.active .info-tooltip {
            opacity: 1;
            visibility: visible;
        }
        
        .move-completed, .transition-completed {
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 700;
            box-shadow: 0 2px 4px rgba(39, 174, 96, 0.3);
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .container { margin: 10px; border-radius: 10px; }
            .header h1 { font-size: 2em; }
            .table-container { padding: 15px; }
            th, td { padding: 8px 6px; font-size: 0.9em; }
            select { width: 70px; padding: 6px; }
            .toggle-switch { width: 50px; height: 24px; }
            .toggle-switch::before { width: 20px; height: 18px; }
            .toggle-switch.active::before { transform: translateX(24px); }
            .charts-container { grid-template-columns: 1fr; }
            .button-container { flex-direction: column; }
            .btn { min-width: auto; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Power Move Scorer</h1>
            <p>Track your breakdancing skills and calculate your total score</p>
        </div>
        
        <div class="table-container">
            <table id="powerMovesTable">
                <thead>
                    <tr>
                        <th>Powermove</th>
                        <th>Base Points</th>
                        <th>Times Performed</th>
                        <th style="width: 120px;">Form</th>
                        <th>Total Points</th>
                    </tr>
                </thead>
                <tbody id="powerMovesBody"></tbody>
            </table>
            
            <h3 class="section-title">Transitions</h3>
            
            <table id="transitionsTable">
                <thead>
                    <tr>
                        <th>Transition</th>
                        <th>Base Points</th>
                        <th style="text-align: center;">Performed?</th>
                        <th>Multiplier</th>
                        <th>Total Points</th>
                    </tr>
                </thead>
                <tbody id="transitionsBody"></tbody>
            </table>
        </div>
        
        <button class="btn btn-primary" onclick="PowerMoveTracker.calculateFinalScore()">
            Calculate my Final Score
        </button>
        
        <div class="score-display" id="scoreDisplay">
            YOUR SCORE: <span id="finalScore">0</span> / <span id="maxScore">0</span> POINTS
        </div>
        
        <div class="summary-section" id="summarySection">
            <h3 class="summary-title">Performance Analysis</h3>
            <p class="summary-description">A comprehensive breakdown of your powermove and transition progression</p>
            
            <div class="charts-container">
                <div class="chart-box">
                    <div class="chart-title">Power Moves Analysis</div>
                    
                    <div class="stat-row basic">
                        <span class="stat-label">Basic Moves:</span>
                        <span class="stat-value" id="basicMovesScore">0 / 0</span>
                    </div>
                    <div class="progress-bar basic">
                        <div class="progress-fill" id="basicMovesProgress" style="width: 0%;"></div>
                    </div>
                    
                    <div class="stat-row intermediate">
                        <span class="stat-label">Intermediate Moves:</span>
                        <span class="stat-value" id="intermediateMovesScore">0 / 0</span>
                    </div>
                    <div class="progress-bar intermediate">
                        <div class="progress-fill" id="intermediateMovesProgress" style="width: 0%;"></div>
                    </div>
                    
                    <div class="stat-row advanced">
                        <span class="stat-label">Advanced Moves:</span>
                        <span class="stat-value" id="advancedMovesScore">0 / 0</span>
                    </div>
                    <div class="progress-bar advanced">
                        <div class="progress-fill" id="advancedMovesProgress" style="width: 0%;"></div>
                    </div>
                </div>
                
                <div class="chart-box">
                    <div class="chart-title">Transition Analysis</div>
                    
                    <div class="stat-row basic">
                        <span class="stat-label">Basic Transitions:</span>
                        <span class="stat-value" id="basicTransitionsCount">0</span>
                    </div>
                    <div class="progress-bar basic">
                        <div class="progress-fill" id="basicTransitionsProgress" style="width: 0%;"></div>
                    </div>
                    
                    <div class="stat-row intermediate">
                        <span class="stat-label">Intermediate Transitions:</span>
                        <span class="stat-value" id="intermediateTransitionsCount">0</span>
                    </div>
                    <div class="progress-bar intermediate">
                        <div class="progress-fill" id="intermediateTransitionsProgress" style="width: 0%;"></div>
                    </div>
                    
                    <div class="stat-row advanced">
                        <span class="stat-label">Advanced Transitions:</span>
                        <span class="stat-value" id="advancedTransitionsCount">0</span>
                    </div>
                    <div class="progress-bar advanced">
                        <div class="progress-fill" id="advancedTransitionsProgress" style="width: 0%;"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="button-container">
            <button class="btn btn-secondary" onclick="PowerMoveTracker.resetAll()">Reset All Scores</button>
            <button class="btn btn-success" onclick="PowerMoveTracker.saveProgress()">Save Progress</button>
            <button class="btn btn-info" onclick="document.getElementById('loadInput').click()">Load Progress</button>
            <input type="file" id="loadInput" accept=".json" style="display: none;" onchange="PowerMoveTracker.loadProgress(event)">
        </div>
    </div>

    <script>
        const PowerMoveTracker = {
            // Data Configuration
            moves: [
                {name: "Windmill (with hands)", base: 1, category: "basic"},
                {name: "Swipe", base: 1, category: "basic"},
                {name: "Cricket", base: 1, category: "basic"},
                {name: "Jackhammer", base: 2, category: "basic"},
                {name: "Headspin", base: 2.5, category: "basic"},
                {name: "Windmill (without hands)", base: 1.5, category: "intermediate"},
                {name: "Halo", base: 3, category: "intermediate"},
                {name: "Flare", base: 3, category: "intermediate"},
                {name: "1990", base: [15, 20, 40, 60, 90, 120, 150, 180, 210, 240], reps: ["1.5", "2", "3", "4", "5", "6", "7", "8", "9", "10"], category: "intermediate"},
                {name: "2000", base: [15, 20, 40, 60, 90, 120, 150, 180, 210, 240], reps: ["1.5", "2", "3", "4", "5", "6", "7", "8", "9", "10"], category: "intermediate"},
                {name: "Left Handhop", base: [15, 20, 40], reps: ["5-9", "10-19", "20-30"], category: "advanced"},
                {name: "Right Handhop", base: [15, 20, 40], reps: ["5-9", "10-19", "20-30"], category: "advanced"},
                {name: "Left Elbow Hop", base: [15, 20, 40], reps: ["5-9", "10-19", "20-30"], category: "advanced"},
                {name: "Right Elbow Hop", base: [15, 20, 40], reps: ["5-9", "10-19", "20-30"], category: "advanced"},
                {name: "Airflare", base: 30, category: "advanced"},
                {name: "Elbow Airflare", base: 30, category: "advanced"}
            ],

            transitions: [
                {name: "Windmill → Flare", base: 4, multiplier: 1},
                {name: "Windmill → Elbow AF", base: 31, multiplier: 1},
                {name: "Windmill → 1990/2000", base: 16, multiplier: 1.8},
                {name: "Windmill → Airflare", base: 31, multiplier: 2},
                {name: "Headspin → Elbow AF", base: 32.5, multiplier: 1},
                {name: "Headspin → 1990/2000", base: 17.5, multiplier: 1},
                {name: "Headspin → Airflare", base: 32.5, multiplier: 1.5},
                {name: "Halo → Elbow AF", base: 33, multiplier: 1},
                {name: "Halo → 1990/2000", base: 18, multiplier: 1},
                {name: "Halo → Airflare", base: 33, multiplier: 1.5},
                {name: "Flare → 1990/2000", base: 18, multiplier: 1.8},
                {name: "Flare → Airflare", base: 33, multiplier: 2},
                {name: "Handstand/1990/2000 → Flare", base: 18, multiplier: 2},
                {name: "Handstand/1990/2000 → Airflare", base: 45, multiplier: 1},
                {name: "Handstand/1990/2000 → Elbow AF", base: 45, multiplier: 1},
                {name: "Elbow AF → Airflare", base: 60, multiplier: 2},
                {name: "Elbow AF → Assisted Elbow Flash", base: 60, multiplier: 2},
                {name: "Elbow AF → Real Elbow Flash", base: 60, multiplier: 2.5}
            ],

            // Utility Functions
            createRepetitionSlider(max = 10, basePoints = null) {
                return `
                    <div class="slider-container">
                        <input type="range" class="slider reps-slider" 
                               min="0" max="${max}" value="0" step="1"
                               data-base="${basePoints}" 
                               oninput="PowerMoveTracker.updateSliderLabel(this, 'reps')">
                        <div class="slider-label">0</div>
                    </div>
                `;
            },

            createSpecialRepetitionSlider(reps, bases) {
                const maxIndex = reps.length;
                return `
                    <div class="slider-container">
                        <input type="range" class="slider special-reps-slider" 
                               min="0" max="${maxIndex}" value="0" step="1"
                               data-bases='${JSON.stringify(bases)}' 
                               data-reps='${JSON.stringify(reps)}'
                               oninput="PowerMoveTracker.updateSliderLabel(this, 'special')">
                        <div class="slider-label">None</div>
                    </div>
                `;
            },

            createFormSlider() {
                const formOptions = ['Select', 'Poor', 'Moderate', 'Best'];
                const formValues = [0, 0.5, 0.75, 1.5];
                
                return `
                    <div class="slider-container">
                        <input type="range" class="slider form-slider" 
                               min="0" max="3" value="0" step="1"
                               data-values='${JSON.stringify(formValues)}'
                               data-labels='${JSON.stringify(formOptions)}'
                               oninput="PowerMoveTracker.updateSliderLabel(this, 'form')">
                        <div class="slider-label">Select</div>
                    </div>
                `;
            },

            updateSliderLabel(slider, type) {
                const label = slider.parentNode.querySelector('.slider-label');
                const value = parseInt(slider.value);
                
                switch(type) {
                    case 'reps':
                        label.textContent = value.toString();
                        break;
                    case 'special':
                        if (value === 0) {
                            label.textContent = 'None';
                        } else {
                            const reps = JSON.parse(slider.dataset.reps);
                            label.textContent = reps[value - 1];
                        }
                        break;
                    case 'form':
                        const labels = JSON.parse(slider.dataset.labels);
                        label.textContent = labels[value];
                        break;
                }
                
                // Trigger calculation
                this.calculateRowTotal({ target: slider });
            },

            // Toggle Functions
            toggleSwitch(element) {
                element.classList.toggle('active');
                this.calculateRowTotal({ target: element });
            },

            // Table Building
            buildTables() {
                this.buildPowerMovesTable();
                this.buildTransitionsTable();
                this.attachEventListeners();
            },

            buildPowerMovesTable() {
                const tbody = document.getElementById('powerMovesBody');
                tbody.innerHTML = '';

                this.moves.forEach(move => {
                    const row = document.createElement('tr');
                    row.classList.add(move.category);
                    
                    const maxPoints = this.calculateMaxPoints(move);
                    row.innerHTML = this.generateMoveRowHTML(move, maxPoints);
                    tbody.appendChild(row);
                });

                // Add total row
                const totalRow = document.createElement('tr');
                totalRow.classList.add('total-row');
                totalRow.innerHTML = `
                    <td colspan="4"><strong>POWERMOVES TOTAL</strong></td>
                    <td class="total-points" id="powerMovesTotal">0</td>
                `;
                tbody.appendChild(totalRow);
            },

            buildTransitionsTable() {
                const tbody = document.getElementById('transitionsBody');
                tbody.innerHTML = '';

                this.transitions.forEach(transition => {
                    const row = document.createElement('tr');
                    const maxPoints = (transition.base * transition.multiplier).toFixed(1);
                    
                    row.innerHTML = `
                        <td class="move-name">${transition.name}</td>
                        <td class="base-points">${transition.base}</td>
                        <td style="text-align: center;">
                            <div class="toggle-switch" onclick="PowerMoveTracker.toggleSwitch(this)" 
                                 data-base="${transition.base}" data-multiplier="${transition.multiplier}">
                            </div>
                        </td>
                        <td>${transition.multiplier > 1 ? `×${transition.multiplier}` : 'None'}</td>
                        <td class="total-points">0/${maxPoints}</td>
                    `;
                    tbody.appendChild(row);
                });

                // Add total rows
                const totalRow = document.createElement('tr');
                totalRow.classList.add('total-row');
                totalRow.innerHTML = `
                    <td colspan="4"><strong>TRANSITIONS TOTAL</strong></td>
                    <td class="total-points" id="transitionsTotal">0</td>
                `;
                tbody.appendChild(totalRow);

                const grandTotalRow = document.createElement('tr');
                grandTotalRow.classList.add('total-row', 'grand-total-row');
                grandTotalRow.innerHTML = `
                    <td colspan="4"><strong>GRAND TOTAL</strong></td>
                    <td class="total-points" id="grandTotal">0</td>
                `;
                tbody.appendChild(grandTotalRow);
            },

            calculateMaxPoints(move) {
                if (Array.isArray(move.base)) {
                    return Math.max(...move.base);
                } else if (move.name === "Flare") {
                    return move.base * 10 * 1.5;
                } else {
                    return move.base * 10;
                }
            },

            generateMoveRowHTML(move, maxPoints) {
                if (Array.isArray(move.base)) {
                    return `
                        <td class="move-name ${move.category}">${move.name}</td>
                        <td class="base-points">Variable</td>
                        <td>${this.createSpecialRepetitionSlider(move.reps, move.base)}</td>
                        <td></td>
                        <td class="total-points">0/${maxPoints}</td>
                    `;
                } else if (move.name === "Flare") {
                    return `
                        <td class="move-name ${move.category}">${move.name}</td>
                        <td class="base-points">${move.base}</td>
                        <td>${this.createRepetitionSlider(10, move.base)}</td>
                        <td>${this.createFormSlider()}</td>
                        <td class="total-points">0/${maxPoints.toFixed(1)}</td>
                    `;
                } else {
                    return `
                        <td class="move-name ${move.category}">${move.name}</td>
                        <td class="base-points">${move.base}</td>
                        <td>${this.createRepetitionSlider(10, move.base)}</td>
                        <td></td>
                        <td class="total-points">0/${maxPoints.toFixed(1)}</td>
                    `;
                }
            },

            // Event Handling
            attachEventListeners() {
                document.querySelectorAll('.reps-slider, .special-reps-slider, .form-slider').forEach(slider => {
                    slider.addEventListener('input', (e) => this.calculateRowTotal(e));
                });
            },

            calculateRowTotal(event) {
                const row = event.target.closest('tr');
                const repsSlider = row.querySelector('.reps-slider');
                const specialRepsSlider = row.querySelector('.special-reps-slider');
                const formSlider = row.querySelector('.form-slider');
                const toggleSwitch = row.querySelector('.toggle-switch');
                const totalCell = row.querySelector('.total-points');

                let total = 0;

                if (repsSlider && formSlider) {
                    // Flare with form multiplier
                    const basePoints = parseFloat(repsSlider.dataset.base);
                    const reps = parseInt(repsSlider.value);
                    const formValues = JSON.parse(formSlider.dataset.values);
                    const multiplier = formValues[parseInt(formSlider.value)];
                    if (multiplier > 0) {
                        total = basePoints * reps * multiplier;
                    }
                } else if (repsSlider) {
                    // Regular moves
                    const basePoints = parseFloat(repsSlider.dataset.base);
                    const reps = parseInt(repsSlider.value);
                    total = basePoints * reps;
                } else if (specialRepsSlider) {
                    // Special moves (1990, 2000, Handhop, Elbow Hop)
                    const bases = JSON.parse(specialRepsSlider.dataset.bases);
                    const selectedIndex = parseInt(specialRepsSlider.value);
                    if (selectedIndex > 0) {
                        total = bases[selectedIndex - 1];
                    }
                } else if (toggleSwitch) {
                    // Transitions
                    const basePoints = parseFloat(toggleSwitch.dataset.base);
                    const multiplier = parseFloat(toggleSwitch.dataset.multiplier);
                    const isActive = toggleSwitch.classList.contains('active');
                    if (isActive) {
                        total = basePoints * multiplier;
                    }
                }

                // Update cell
                if (totalCell) {
                    const maxValue = totalCell.textContent.split('/')[1];
                    totalCell.textContent = maxValue ? `${total.toFixed(1)}/${maxValue}` : total.toFixed(1);
                }

                this.calculateTotals();
            },

            // Score Calculations
            calculateTotals() {
                const powerMovesTotal = this.calculateSectionTotal('#powerMovesBody .total-points:not(#powerMovesTotal)');
                const transitionsTotal = this.calculateSectionTotal('#transitionsBody .total-points:not(#transitionsTotal):not(#grandTotal)');
                const grandTotal = powerMovesTotal + transitionsTotal;

                this.updateElement('powerMovesTotal', powerMovesTotal.toFixed(1));
                this.updateElement('transitionsTotal', transitionsTotal.toFixed(1));
                this.updateElement('grandTotal', grandTotal.toFixed(1));
            },

            calculateSectionTotal(selector) {
                let total = 0;
                document.querySelectorAll(selector).forEach(cell => {
                    const currentValue = parseFloat(cell.textContent.split('/')[0]);
                    if (!isNaN(currentValue) && currentValue > 0) {
                        total += currentValue;
                    }
                });
                return total;
            },

            calculateFinalScore() {
                const powerMovesTotal = this.calculateSectionTotal('#powerMovesBody .total-points:not(#powerMovesTotal)');
                const transitionsTotal = this.calculateSectionTotal('#transitionsBody .total-points:not(#transitionsTotal):not(#grandTotal)');
                const grandTotal = powerMovesTotal + transitionsTotal;

                // Calculate max possible scores
                const maxPowerMoves = this.moves.reduce((sum, move) => sum + this.calculateMaxPoints(move), 0);
                const maxTransitions = this.transitions.reduce((sum, t) => sum + (t.base * t.multiplier), 0);
                const totalMax = maxPowerMoves + maxTransitions;

                // Display score
                this.updateElement('finalScore', grandTotal.toFixed(1));
                this.updateElement('maxScore', totalMax.toFixed(1));
                this.showElement('scoreDisplay');

                // Generate analysis
                this.generateAnalysis(powerMovesTotal, transitionsTotal, maxPowerMoves, maxTransitions);
                this.showElement('summarySection');

                // Smooth scroll to score
                setTimeout(() => {
                    document.getElementById('scoreDisplay').scrollIntoView({
                        behavior: 'smooth',
                        block: 'center'
                    });
                }, 100);
            },

            // Analysis Generation
            generateAnalysis(powerMovesTotal, transitionsTotal, maxPowerMoves, maxTransitions) {
                this.analyzeMovesCategories();
                this.analyzeTransitionCategories();
            },

            analyzeMovesCategories() {
                const categories = { basic: { score: 0, max: 0 }, intermediate: { score: 0, max: 0 }, advanced: { score: 0, max: 0 } };

                this.moves.forEach(move => {
                    const currentScore = this.getCurrentMoveScore(move.name);
                    const maxScore = this.calculateMaxPoints(move);
                    
                    categories[move.category].score += currentScore;
                    categories[move.category].max += maxScore;
                });

                // Update UI
                Object.keys(categories).forEach(category => {
                    const data = categories[category];
                    const percentage = data.max > 0 ? (data.score / data.max * 100) : 0;
                    
                    this.updateElement(`${category}MovesScore`, `${data.score.toFixed(1)} / ${data.max.toFixed(1)}`);
                    this.updateElement(`${category}MovesProgress`, '', el => el.style.width = `${percentage}%`);
                });
            },

            analyzeTransitionCategories() {
                const categories = { basic: { completed: 0, total: 0 }, intermediate: { completed: 0, total: 0 }, advanced: { completed: 0, total: 0 } };

                this.transitions.forEach(transition => {
                    const maxPoints = transition.base * transition.multiplier;
                    let category = 'basic';
                    if (maxPoints >= 60) category = 'advanced';
                    else if (maxPoints >= 33) category = 'intermediate';

                    categories[category].total++;

                    if (this.isTransitionCompleted(transition.name)) {
                        categories[category].completed++;
                    }
                });

                // Update UI
                Object.keys(categories).forEach(category => {
                    const data = categories[category];
                    const percentage = data.total > 0 ? (data.completed / data.total * 100) : 0;
                    
                    this.updateElement(`${category}TransitionsCount`, `${data.completed} / ${data.total}`);
                    this.updateElement(`${category}TransitionsProgress`, '', el => el.style.width = `${percentage}%`);
                });
            },

            getCurrentMoveScore(moveName) {
                const rows = document.querySelectorAll('#powerMovesBody tr:not(.total-row)');
                for (let row of rows) {
                    const nameCell = row.querySelector('.move-name');
                    if (nameCell && nameCell.textContent === moveName) {
                        const totalCell = row.querySelector('.total-points');
                        if (totalCell) {
                            return parseFloat(totalCell.textContent.split('/')[0]) || 0;
                        }
                    }
                }
                return 0;
            },

            isTransitionCompleted(transitionName) {
                const rows = document.querySelectorAll('#transitionsBody tr:not(.total-row)');
                for (let row of rows) {
                    const nameCell = row.querySelector('.move-name');
                    const toggleSwitch = row.querySelector('.toggle-switch');
                    if (nameCell && nameCell.textContent === transitionName && 
                        toggleSwitch && toggleSwitch.classList.contains('active')) {
                        return true;
                    }
                }
                return false;
            },

            // Save/Load Functionality
            saveProgress() {
                const progressData = {
                    timestamp: new Date().toISOString(),
                    version: "2.0",
                    powerMoves: this.extractPowerMovesData(),
                    transitions: this.extractTransitionsData(),
                    metadata: this.calculateMetadata()
                };

                this.downloadFile(progressData, this.generateFilename());
                this.showNotification('Progress saved successfully!', 'success');
            },

            extractPowerMovesData() {
                const data = {};
                document.querySelectorAll('#powerMovesBody tr:not(.total-row)').forEach(row => {
                    const nameCell = row.querySelector('.move-name');
                    if (nameCell) {
                        const moveName = nameCell.textContent;
                        data[moveName] = {
                            reps: this.getSelectValue(row, '.reps'),
                            specialReps: this.getSelectValue(row, '.special-reps'),
                            formMultiplier: this.getSelectValue(row, '.form-multiplier'),
                            totalScore: this.getTotalScore(row)
                        };
                    }
                });
                return data;
            },

            extractTransitionsData() {
                const data = {};
                document.querySelectorAll('#transitionsBody tr:not(.total-row)').forEach(row => {
                    const nameCell = row.querySelector('.move-name');
                    const toggleSwitch = row.querySelector('.toggle-switch');
                    if (nameCell && toggleSwitch) {
                        data[nameCell.textContent] = {
                            completed: toggleSwitch.classList.contains('active'),
                            totalScore: this.getTotalScore(row)
                        };
                    }
                });
                return data;
            },

            calculateMetadata() {
                return {
                    powerMovesScore: parseFloat(this.getElementText('powerMovesTotal')),
                    transitionsScore: parseFloat(this.getElementText('transitionsTotal')),
                    totalScore: parseFloat(this.getElementText('grandTotal'))
                };
            },

            loadProgress(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const progressData = JSON.parse(e.target.result);
                        this.validateProgressData(progressData);
                        this.restoreProgressData(progressData);
                        this.showNotification(`Progress loaded successfully!\nSaved: ${new Date(progressData.timestamp).toLocaleString()}`, 'success');
                    } catch (error) {
                        console.error('Error loading progress:', error);
                        this.showNotification('Error loading file. Please check the file format.', 'error');
                    }
                    event.target.value = '';
                };
                reader.readAsText(file);
            },

            validateProgressData(data) {
                if (!data.powerMoves || !data.transitions) {
                    throw new Error('Invalid file format');
                }
            },

            restoreProgressData(data) {
                this.resetAll();
                this.restorePowerMovesData(data.powerMoves);
                this.restoreTransitionsData(data.transitions);
            },

            restorePowerMovesData(movesData) {
                document.querySelectorAll('#powerMovesBody tr:not(.total-row)').forEach(row => {
                    const nameCell = row.querySelector('.move-name');
                    if (!nameCell) return;

                    const moveData = movesData[nameCell.textContent];
                    if (moveData) {
                        this.setSelectValue(row, '.reps', moveData.reps);
                        this.setSelectValue(row, '.special-reps', moveData.specialReps);
                        this.setSelectValue(row, '.form-multiplier', moveData.formMultiplier);
                        
                        const selectElement = row.querySelector('.reps, .special-reps, .form-multiplier');
                        if (selectElement) {
                            this.calculateRowTotal({ target: selectElement });
                        }
                    }
                });
            },

            restoreTransitionsData(transitionsData) {
                document.querySelectorAll('#transitionsBody tr:not(.total-row)').forEach(row => {
                    const nameCell = row.querySelector('.move-name');
                    const toggleSwitch = row.querySelector('.toggle-switch');
                    
                    if (!nameCell || !toggleSwitch) return;

                    const transitionData = transitionsData[nameCell.textContent];
                    if (transitionData && transitionData.completed) {
                        toggleSwitch.classList.add('active');
                        this.calculateRowTotal({ target: toggleSwitch });
                    }
                });
            },

            // Reset Functionality
            resetAll() {
                // Reset all controls
                document.querySelectorAll('.reps, .special-reps, .form-multiplier').forEach(select => select.value = '0');
                document.querySelectorAll('.toggle-switch').forEach(toggle => toggle.classList.remove('active'));
                
                // Reset all totals
                document.querySelectorAll('.total-points').forEach(cell => {
                    const currentText = cell.textContent;
                    if (currentText.includes('/')) {
                        const maxValue = currentText.split('/')[1];
                        cell.textContent = `0/${maxValue}`;
                    } else {
                        cell.textContent = '0';
                    }
                });
                
                // Hide displays
                this.hideElement('scoreDisplay');
                this.hideElement('summarySection');
            },

            // Utility Helper Functions
            updateElement(id, text, callback) {
                const element = document.getElementById(id);
                if (element) {
                    if (text !== undefined) element.textContent = text;
                    if (callback) callback(element);
                }
            },

            showElement(id) {
                const element = document.getElementById(id);
                if (element) element.style.display = 'block';
            },

            hideElement(id) {
                const element = document.getElementById(id);
                if (element) element.style.display = 'none';
            },

            getTotalScore(row) {
                const totalCell = row.querySelector('.total-points');
                return totalCell ? parseFloat(totalCell.textContent.split('/')[0]) || 0 : 0;
            },

            getElementText(id) {
                const element = document.getElementById(id);
                return element ? element.textContent : '0';
            },

            downloadFile(data, filename) {
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            },

            generateFilename() {
                const now = new Date();
                const dateStr = now.toISOString().split('T')[0];
                const timeStr = now.toTimeString().split(' ')[0].replace(/:/g, '-');
                return `powermove-progress-${dateStr}-${timeStr}.json`;
            },

            // Notification System
            showNotification(message, type = 'success') {
                const existingNotification = document.querySelector('.notification');
                if (existingNotification) existingNotification.remove();

                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                document.body.appendChild(notification);

                setTimeout(() => notification.classList.add('show'), 100);
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 400);
                }, 4000);
            },

            // Initialization
            init() {
                this.buildTables();
            }
        };

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            PowerMoveTracker.init();
        });
    </script>
</body>
</html>
